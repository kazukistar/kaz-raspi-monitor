<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, viewport-fit=cover" />
  <title>KAZ-RASPI / NERV MONITOR</title>

  <!-- EVA-ish fonts:
    - English/UI: Rajdhani (condensed) + Share Tech Mono (tech)
    - Japanese: Noto Serif JP bold (Mincho)
    - Digits: DSEG7 (7-seg clock)
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Share+Tech+Mono&family=Noto+Serif+JP:wght@700;900&display=swap" rel="stylesheet">
  <!-- DSEG7 (7-seg) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/keshikan/DSEG@v0.46.0/css/dseg.css">

  <style>
    :root{
      /* EVA yellow */
      --evaY: #FFC400;
      --evaY2:#FFB100;
      --evaYline: rgba(255,196,0,.92);
      --evaYline2: rgba(255,196,0,.28);
      --evaFill1: rgba(255,196,0,.14);
      --evaFill2: rgba(255,196,0,.02);

      --bg0:#020305;
      --bg1:#06070a;

      --text: rgba(255, 240, 210, .95);
      --muted: rgba(255, 240, 210, .70);

      --warn:#FF2A2A;
      --caution:#FF6A2B;

      --pad:14px;
      --gap:14px;

      /* 2-3-4-5 SAFE RECT in HEX */
      --safe-left: 18%;
      --safe-right: 18%;
      --safe-top: 16%;
      --safe-bottom: 16%;
    }

    *{ box-sizing:border-box; }
    html,body{
      width:100%;
      height:100%;
      margin:0;
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255,196,0,.11), transparent 62%),
        radial-gradient(900px 600px at 80% 80%, rgba(255,42,42,.08), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--text);
      overflow:hidden;
    }

    /* Fonts */
    .font-en { font-family:"Rajdhani", system-ui, sans-serif; letter-spacing:.20em; text-transform:uppercase; }
    .font-mono { font-family:"Share Tech Mono", ui-monospace, monospace; letter-spacing:.16em; text-transform:uppercase; }
    .font-jp { font-family:"Noto Serif JP", serif; font-weight:900; letter-spacing:.18em; }
    .font-7seg { font-family:"DSEG7Classic", ui-monospace, monospace; letter-spacing:.06em; }

    /* Frame */
    .frame{
      height:100%;
      width:100%;
      padding:
        calc(var(--pad) + env(safe-area-inset-top))
        calc(var(--pad) + env(safe-area-inset-right))
        calc(var(--pad) + env(safe-area-inset-bottom))
        calc(var(--pad) + env(safe-area-inset-left));
      display:flex;
      flex-direction:column;
      gap:var(--gap);
      overflow:auto;
    }

    /* Header */
    .header{
      position:relative;
      border:1px solid var(--evaYline2);
      background: linear-gradient(90deg, rgba(255,196,0,.13), rgba(255,196,0,.02));
      padding:12px 14px;
      box-shadow: 0 0 28px rgba(255,196,0,.10);
    }
    .header::before{
      content:"";
      position:absolute;
      inset:-2px;
      border:1px solid rgba(255,196,0,.12);
      pointer-events:none;
    }
    .hdrRow{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
    }
    .hdrTitle{
      font-size:22px;
      color:rgba(255,240,210,.95);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hdrSub{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:6px 10px;
      border:1px solid rgba(255,196,0,.62);
      background: rgba(255,196,0,.06);
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background:var(--evaY);
      box-shadow: 0 0 16px rgba(255,196,0,.22);
    }

    /* Layout */
    .grid{
      display:flex;
      flex-direction:column;
      gap:var(--gap);
    }

    /* ===== Hex Stack: center column + dummy left/right columns ===== */
    .hexStack{
      display:grid;
      grid-template-columns: 1fr min(420px, 96vw) 1fr;
      gap:var(--gap);
      align-items:start;
    }
    @media (max-width: 520px){
      .hexStack{
        grid-template-columns: 1fr; /* phone: hide side columns to save space */
      }
      .sideCol{ display:none; }
    }

    .sideCol{
      display:flex;
      flex-direction:column;
      gap:var(--gap);
      opacity:.55; /* “無駄UI”っぽい */
      filter: drop-shadow(0 0 10px rgba(255,196,0,.06));
      padding-top: 10px;
    }

    /* Regular hex tile */
    .hexUnit{
      position:relative;
      width:100%;
      aspect-ratio: 1 / 1; /* keep square => regular hex */
      min-height: 220px;
      max-height: 360px;
      filter: drop-shadow(0 0 14px rgba(255,196,0,.10));
    }
    .hexUnit.lg{ min-height: 290px; max-height: 420px; }
    .hexUnit.sm{ min-height: 210px; max-height: 320px; }
    .hexUnit.dummy{ min-height: 150px; max-height: 220px; opacity:.6; }

    .hexSvg{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
    }

    /* 2-3-4-5 safe box */
    .safeBox{
      position:absolute;
      left: var(--safe-left);
      right: var(--safe-right);
      top: var(--safe-top);
      bottom: var(--safe-bottom);

      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;

      gap:10px;
      overflow:hidden;
      min-width:0;
      min-height:0;
    }

    /* Labels inside */
    .jpTitle{
      font-size: clamp(18px, 3.6vw, 26px);
      color: rgba(255,240,210,.92);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      width:100%;
    }

    /* Big 7-seg number */
    .bigNum{
      width:100%;
      font-size: clamp(44px, 10.8vw, 86px);
      line-height:1.0;
      color: rgba(255,240,210,.96);
      text-shadow: 0 0 26px rgba(255,196,0,.14);

      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hexUnit.lg .bigNum{
      font-size: clamp(54px, 12.5vw, 98px);
    }
    .unit{
      font-size:.40em;
      margin-left:8px;
      color: rgba(255,196,0,.98);
    }

    .enSub{
      width:100%;
      font-size:12px;
      color: rgba(255,240,210,.72);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Ring gauge */
    .gaugeWrap{
      width:100%;
      display:flex;
      justify-content:center;
      gap:12px;
      align-items:center;
      margin-top:2px;
    }
    .gauge{
      width:78px;
      height:78px;
      position:relative;
      flex:0 0 auto;
      filter: drop-shadow(0 0 10px rgba(255,196,0,.08));
    }
    .gauge svg{ width:100%; height:100%; transform: rotate(-90deg); }
    .gBg{
      stroke: rgba(255,196,0,.16);
      stroke-width: 10;
      fill: none;
    }
    .gFg{
      stroke: rgba(255,196,0,.90);
      stroke-width: 10;
      fill: none;
      stroke-linecap: round;
      stroke-dasharray: 0 999;
      transition: stroke-dasharray .45s ease, stroke .45s ease;
    }
    .gLabel{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      font-size:14px;
      color: rgba(255,240,210,.86);
    }

    /* Small info line */
    .infoRow{
      width:100%;
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size:12px;
      color: rgba(255,240,210,.68);
      border-top:1px dashed rgba(255,196,0,.18);
      padding-top:10px;
      margin-top:6px;
    }

    /* Bars */
    .barWrap{ width:100%; display:flex; flex-direction:column; gap:10px; }
    .bar{
      height:12px;
      border:1px solid rgba(255,196,0,.32);
      background: rgba(255,196,0,.06);
      position:relative;
      overflow:hidden;
    }
    .bar > i{
      position:absolute; inset:0;
      width:40%;
      display:block;
      background: linear-gradient(90deg, rgba(255,196,0,.84), rgba(255,196,0,.20));
      transition: width .45s ease;
    }
    .lineText{
      width:100%;
      font-size:12px;
      color: rgba(255,240,210,.82);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Services */
    .svc{
      width:100%;
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:6px;
      border-top:1px dashed rgba(255,196,0,.18);
      padding-top:10px;
      color: rgba(255,240,210,.82);
      font-size:12px;
    }
    .svcLine{
      width:100%;
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
      min-width:0;
    }
    .svcName{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      text-transform:uppercase;
    }
    .svcState{
      padding:2px 8px;
      border:1px solid rgba(255,196,0,.30);
      background: rgba(255,196,0,.06);
      text-transform:uppercase;
      white-space:nowrap;
    }

    /* Severity (changes stroke/fill + gauge color) */
    .sev-ok{
      --stroke: rgba(255,196,0,.92);
      --stroke2: rgba(255,196,0,.28);
      --fill1: rgba(255,196,0,.14);
      --fill2: rgba(255,196,0,.02);
      --gauge: rgba(255,196,0,.90);
    }
    .sev-caution{
      --stroke: rgba(255,106,43,.92);
      --stroke2: rgba(255,106,43,.26);
      --fill1: rgba(255,106,43,.14);
      --fill2: rgba(255,106,43,.02);
      --gauge: rgba(255,106,43,.92);
    }
    .sev-warn{
      --stroke: rgba(255,42,42,.94);
      --stroke2: rgba(255,42,42,.28);
      --fill1: rgba(255,42,42,.16);
      --fill2: rgba(255,42,42,.02);
      --gauge: rgba(255,42,42,.94);
      animation: pulse 1.1s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ filter: drop-shadow(0 0 12px rgba(255,42,42,.12)); }
      50%{ filter: drop-shadow(0 0 30px rgba(255,42,42,.22)); }
    }
  </style>
</head>

<body>
  <div class="frame">

    <!-- Header -->
    <div class="header">
      <div class="hdrRow">
        <div class="hdrTitle font-en">KAZ-RASPI</div>
        <div class="pill">
          <span class="dot"></span>
          <span class="font-en" style="font-size:14px; color:rgba(255,240,210,.90);">SYSTEM / ONLINE</span>
        </div>
      </div>
      <div class="hdrSub font-mono">
        <span>SERVER STATUS MONITOR</span>
        <span>UPDATE: <b id="updateAge">1.0</b> S</span>
      </div>
    </div>

    <div class="grid">

      <!-- Center stack + dummy side hex columns -->
      <div class="hexStack">

        <!-- left dummy column -->
        <div class="sideCol" aria-hidden="true">
          <section class="hexUnit dummy sev-ok">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="rgba(255,196,0,.04)" stroke="rgba(255,196,0,.35)" stroke-width="1.5"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="rgba(255,196,0,.16)" stroke-width="1"/>
            </svg>
          </section>
          <section class="hexUnit dummy sev-ok">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="rgba(255,196,0,.04)" stroke="rgba(255,196,0,.35)" stroke-width="1.5"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="rgba(255,196,0,.16)" stroke-width="1"/>
            </svg>
          </section>
          <section class="hexUnit dummy sev-ok">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="rgba(255,196,0,.04)" stroke="rgba(255,196,0,.35)" stroke-width="1.5"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="rgba(255,196,0,.16)" stroke-width="1"/>
            </svg>
          </section>
        </div>

        <!-- center column (real tiles) -->
        <div class="grid" style="gap:var(--gap)">

          <!-- CPU TEMP -->
          <section class="hexUnit lg sev-ok" id="tempHex">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="gFillTemp" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="var(--fill1)"/>
                  <stop offset="1" stop-color="var(--fill2)"/>
                </linearGradient>
              </defs>
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="url(#gFillTemp)" stroke="var(--stroke)" stroke-width="2.0"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="var(--stroke2)" stroke-width="1.2"/>
            </svg>

            <div class="safeBox">
              <div class="jpTitle font-jp">CPU温度</div>
              <div class="bigNum font-7seg">
                <span id="cpuTemp">58</span><span class="unit">℃</span>
              </div>
              <div class="enSub font-mono">CPU TEMP</div>

              <div class="gaugeWrap">
                <div class="gauge" data-gauge="temp">
                  <svg viewBox="0 0 100 100">
                    <circle class="gBg" cx="50" cy="50" r="38"></circle>
                    <circle class="gFg" id="gTemp" cx="50" cy="50" r="38"></circle>
                  </svg>
                  <div class="gLabel font-en"><span id="gTempP">--</span>%</div>
                </div>
              </div>

              <div class="infoRow font-mono">
                <span>STATUS: <b id="tempState">NORMAL</b></span>
                <span>TH: <b>60</b>/<b>75</b></span>
              </div>
            </div>
          </section>

          <!-- CPU UTIL -->
          <section class="hexUnit sm sev-ok" id="cpuHex">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="gFillCPU" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="var(--fill1)"/>
                  <stop offset="1" stop-color="var(--fill2)"/>
                </linearGradient>
              </defs>
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="url(#gFillCPU)" stroke="var(--stroke)" stroke-width="2.0"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="var(--stroke2)" stroke-width="1.2"/>
            </svg>

            <div class="safeBox">
              <div class="jpTitle font-jp">CPU稼働率</div>
              <div class="bigNum font-7seg">
                <span id="cpuUtil">41</span><span class="unit">%</span>
              </div>
              <div class="enSub font-mono">CPU UTILIZATION</div>

              <div class="gaugeWrap">
                <div class="gauge" data-gauge="cpu">
                  <svg viewBox="0 0 100 100">
                    <circle class="gBg" cx="50" cy="50" r="38"></circle>
                    <circle class="gFg" id="gCPU" cx="50" cy="50" r="38"></circle>
                  </svg>
                  <div class="gLabel font-en"><span id="gCPUP">--</span>%</div>
                </div>
              </div>

              <div class="infoRow font-mono">
                <span>STATUS: <b id="cpuState">NORMAL</b></span>
                <span>LOAD: <b id="loadAvg">0.74</b></span>
              </div>
            </div>
          </section>

          <!-- RAM UTIL -->
          <section class="hexUnit sm sev-ok" id="ramHex">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="gFillRAM" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="var(--fill1)"/>
                  <stop offset="1" stop-color="var(--fill2)"/>
                </linearGradient>
              </defs>
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="url(#gFillRAM)" stroke="var(--stroke)" stroke-width="2.0"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="var(--stroke2)" stroke-width="1.2"/>
            </svg>

            <div class="safeBox">
              <div class="jpTitle font-jp">メモリ稼働率</div>
              <div class="bigNum font-7seg">
                <span id="ramUtil">63</span><span class="unit">%</span>
              </div>
              <div class="enSub font-mono">MEMORY UTILIZATION</div>

              <div class="gaugeWrap">
                <div class="gauge" data-gauge="ram">
                  <svg viewBox="0 0 100 100">
                    <circle class="gBg" cx="50" cy="50" r="38"></circle>
                    <circle class="gFg" id="gRAM" cx="50" cy="50" r="38"></circle>
                  </svg>
                  <div class="gLabel font-en"><span id="gRAMP">--</span>%</div>
                </div>
              </div>

              <div class="infoRow font-mono">
                <span>USED: <b id="ramUsed">2.6</b>/<b id="ramTotal">4.0</b>GB</span>
                <span>UP: <b id="uptime">00:00:00</b></span>
              </div>
            </div>
          </section>

          <!-- STORAGE + SERVICES (smaller tiles) -->
          <section class="hexUnit sm sev-ok" id="storHex">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="gFillST" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0" stop-color="var(--fill1)"/>
                  <stop offset="1" stop-color="var(--fill2)"/>
                </linearGradient>
              </defs>
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="url(#gFillST)" stroke="var(--stroke)" stroke-width="2.0"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="var(--stroke2)" stroke-width="1.2"/>
            </svg>

            <div class="safeBox">
              <div class="jpTitle font-jp">記憶容量</div>

              <div class="barWrap">
                <div class="lineText font-mono">SD CARD</div>
                <div class="bar"><i id="sdBar" style="width:31%"></i></div>
                <div class="lineText font-mono" id="sdText">USED 18.3 / 58.3 GB (31%)</div>

                <div style="height:8px"></div>

                <div class="lineText font-mono">EXT HDD-01</div>
                <div class="bar"><i id="hddBar" style="width:21%"></i></div>
                <div class="lineText font-mono" id="hddText">USED 212 / 1000 GB (21%)</div>
              </div>

              <div class="svc font-mono">
                <div class="svcLine">
                  <div class="svcName">GOJA-DENPO-SERVER</div>
                  <div class="svcState" id="svcDenpo">稼働中...</div>
                </div>
                <div class="svcLine">
                  <div class="svcName">GOJA-CLOUD-SERVER</div>
                  <div class="svcState" id="svcCloud">稼働中...</div>
                </div>
              </div>
            </div>
          </section>

        </div>

        <!-- right dummy column -->
        <div class="sideCol" aria-hidden="true">
          <section class="hexUnit dummy sev-ok">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="rgba(255,196,0,.04)" stroke="rgba(255,196,0,.35)" stroke-width="1.5"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="rgba(255,196,0,.16)" stroke-width="1"/>
            </svg>
          </section>
          <section class="hexUnit dummy sev-ok">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="rgba(255,196,0,.04)" stroke="rgba(255,196,0,.35)" stroke-width="1.5"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="rgba(255,196,0,.16)" stroke-width="1"/>
            </svg>
          </section>
          <section class="hexUnit dummy sev-ok">
            <svg class="hexSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
              <polygon points="50,2 93,25 93,75 50,98 7,75 7,25" fill="rgba(255,196,0,.04)" stroke="rgba(255,196,0,.35)" stroke-width="1.5"/>
              <polygon points="50,6 89,27.5 89,72.5 50,94 11,72.5 11,27.5" fill="none" stroke="rgba(255,196,0,.16)" stroke-width="1"/>
            </svg>
          </section>
        </div>

      </div>

    </div>
  </div>

  <script>
    const el = (id) => document.getElementById(id);

    const tempHex = el("tempHex");
    const cpuHex  = el("cpuHex");
    const ramHex  = el("ramHex");
    const storHex = el("storHex");

    let last = performance.now();
    let uptimeSec = 0;

    const CIRC = 2 * Math.PI * 38; // r=38 in gauge circles

    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

    function setSeverity(node, sev){
      node.classList.remove("sev-ok","sev-caution","sev-warn");
      node.classList.add(sev);
      // also apply gauge color
      if(node === tempHex) el("gTemp").style.stroke = getComputedStyle(node).getPropertyValue("--gauge");
      if(node === cpuHex)  el("gCPU").style.stroke  = getComputedStyle(node).getPropertyValue("--gauge");
      if(node === ramHex)  el("gRAM").style.stroke  = getComputedStyle(node).getPropertyValue("--gauge");
    }

    function tempState(t){
      if(t >= 75) return {label:"EMERGENCY", sev:"sev-warn"};
      if(t >= 60) return {label:"CAUTION", sev:"sev-caution"};
      return {label:"NORMAL", sev:"sev-ok"};
    }
    function percentState(p){
      if(p >= 90) return {label:"EMERGENCY", sev:"sev-warn"};
      if(p >= 75) return {label:"CAUTION", sev:"sev-caution"};
      return {label:"NORMAL", sev:"sev-ok"};
    }

    function formatUptime(sec){
      sec = Math.max(0, Math.floor(sec));
      const h = String(Math.floor(sec/3600)).padStart(2,'0');
      const m = String(Math.floor((sec%3600)/60)).padStart(2,'0');
      const s = String(sec%60).padStart(2,'0');
      return `${h}:${m}:${s}`;
    }

    function setGauge(circleId, labelId, p){
      p = clamp(p, 0, 100);
      const on = (CIRC * p/100);
      const off = (CIRC - on);
      const c = el(circleId);
      c.style.strokeDasharray = `${on} ${off}`;
      el(labelId).textContent = String(Math.round(p)).padStart(2,'0');
    }

    const services = {
      denpo: {state:"active"},
      cloud: {state:"active"},
    };
    function serviceLabel(st){
      if(st === "active") return "稼働中...";
      if(st === "restarting") return "再起動中...";
      return "停止";
    }

    function maybeFlipServices(){
      const r = Math.random();
      if(r < 0.03) services.denpo.state = "restarting";
      else if(r < 0.04) services.denpo.state = "inactive";
      else if(r < 0.09) services.denpo.state = "active";

      const c = Math.random();
      if(c < 0.02) services.cloud.state = "restarting";
      else if(c < 0.03) services.cloud.state = "inactive";
      else if(c < 0.08) services.cloud.state = "active";

      el("svcDenpo").textContent = serviceLabel(services.denpo.state);
      el("svcCloud").textContent = serviceLabel(services.cloud.state);
    }

    function tick(){
      const now = performance.now();
      const dt = (now - last) / 1000;
      last = now;

      uptimeSec += dt;
      el("updateAge").textContent = "1.0";
      el("uptime").textContent = formatUptime(uptimeSec);

      // Temp (integer like your clock photo)
      const t = clamp(58 + (Math.random()*16 - 8) + Math.sin(uptimeSec/7)*5, 40, 86);
      const tInt = Math.round(t);
      el("cpuTemp").textContent = String(tInt).padStart(2,'0');
      const ts = tempState(tInt);
      el("tempState").textContent = ts.label;
      setSeverity(tempHex, ts.sev);

      // CPU util (integer)
      const cpu = clamp(42 + (Math.random()*50 - 25) + (tInt-55)*1.0, 1, 99);
      const cpuInt = Math.round(cpu);
      el("cpuUtil").textContent = String(cpuInt).padStart(2,'0');
      const cs = percentState(cpuInt);
      el("cpuState").textContent = cs.label;
      setSeverity(cpuHex, cs.sev);

      // Load
      const load = clamp((cpuInt/100)*2.4 + Math.random()*0.35, 0.05, 3.5);
      el("loadAvg").textContent = load.toFixed(2);

      // RAM util (integer)
      const ram = clamp(60 + (Math.random()*34 - 17), 5, 99);
      const ramInt = Math.round(ram);
      el("ramUtil").textContent = String(ramInt).padStart(2,'0');
      el("ramTotal").textContent = "4.0";
      el("ramUsed").textContent = (4.0 * ramInt/100).toFixed(1);
      const rs = percentState(ramInt);
      setSeverity(ramHex, rs.sev);

      // Gauges (animate separately for “moving meter” vibe)
      setGauge("gTemp", "gTempP", clamp((tInt-30)/60*100, 0, 100));
      setGauge("gCPU", "gCPUP", cpuInt);
      setGauge("gRAM", "gRAMP", ramInt);

      // Storage (animate)
      const sdP = clamp(20 + Math.random()*40, 1, 98);
      el("sdBar").style.width = `${sdP.toFixed(0)}%`;
      el("sdText").textContent = `USED ${(58.3*sdP/100).toFixed(1)} / 58.3 GB (${sdP.toFixed(0)}%)`;

      const hddP = clamp(10 + Math.random()*35, 1, 99);
      el("hddBar").style.width = `${hddP.toFixed(0)}%`;
      el("hddText").textContent = `USED ${(1000*hddP/100).toFixed(0)} / 1000 GB (${hddP.toFixed(0)}%)`;

      // Services
      maybeFlipServices();
      // if any service down -> make storage tile react (small drama)
      const anyDown = (services.denpo.state === "inactive") || (services.cloud.state === "inactive");
      const anyRestart = (services.denpo.state === "restarting") || (services.cloud.state === "restarting");
      if(anyDown) storHex.classList.add("sev-warn"), storHex.classList.remove("sev-ok","sev-caution");
      else if(anyRestart) storHex.classList.add("sev-caution"), storHex.classList.remove("sev-ok","sev-warn");
      else storHex.classList.add("sev-ok"), storHex.classList.remove("sev-caution","sev-warn");

      requestAnimationFrame(tick);
    }

    // init gauge colors (read css vars)
    setSeverity(tempHex, "sev-ok");
    setSeverity(cpuHex,  "sev-ok");
    setSeverity(ramHex,  "sev-ok");
    requestAnimationFrame(tick);
  </script>
</body>
</html>