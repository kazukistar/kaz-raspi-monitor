<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>GOJA UI Position Tuner (Square)</title>

  <!-- Fonts（数字=デジタル寄り / 日本語=明朝寄り） -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Noto+Serif+JP:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#000;
      --gold:#f4b000;

      /* 初期値（スライダーで更新） */
      --titleY: 0px;
      --numY: 0px;
      --dashY: 0px;
      --statusY: 0px;

      --titleSize: 22px;
      --numSize: 92px;
      --statusSize: 20px;

      --dashW: 220px;

      /* 四角枠の角丸 */
      --boxRadius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{
      height:100%;
      background:var(--bg);
      color:#fff;
      margin:0;
      -webkit-text-size-adjust: 100%;
      font-feature-settings: "palt" 1;
    }

    .wrap{
      min-height: 100%;
      padding: 24px 16px 120px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
    }

    /* ===== カード（正方形固定で“縦長”防止） ===== */
    .card{
      width: min(92vw, 560px);
      aspect-ratio: 1 / 1;
      background: #000; /* 背景は真っ黒 */
      border-radius: 22px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.06), 0 20px 60px rgba(0,0,0,0.55);
    }

    /* 四角枠SVG */
    .frame{
      position:absolute;
      inset: 0;
      display:block;
      width:100%;
      height:100%;
      pointer-events:none;
      filter: drop-shadow(0 0 12px rgba(244,176,0,0.18));
    }

    /* テキストレイヤ */
    .layer{
      position:absolute;
      inset:0;
      pointer-events:none;
    }

    .title{
      position:absolute;
      left:50%;
      top: 20%;
      transform: translate(-50%,-50%) translateY(var(--titleY));
      font-family: "Noto Serif JP","Yu Mincho","Hiragino Mincho ProN",serif;
      font-weight: 700;
      font-size: var(--titleSize);
      letter-spacing: 0.08em;
      color: var(--gold);
      text-shadow: 0 0 10px rgba(244,176,0,0.12);
      white-space: nowrap;
    }

    .numRow{
      position:absolute;
      left:50%;
      top: 44%;
      transform: translate(-50%,-50%) translateY(var(--numY));
      display:flex;
      align-items: baseline;
      gap: 10px;
      color: var(--gold);
      text-shadow: 0 0 14px rgba(244,176,0,0.12);
      white-space: nowrap;
    }

    .num{
      font-family: "Orbitron", ui-monospace, SFMono-Regular, Menlo, monospace;
      font-weight: 700;
      font-size: var(--numSize);
      line-height: 1;
      letter-spacing: 0.02em;
    }

    .unit{
      font-family: "Orbitron", ui-monospace, SFMono-Regular, Menlo, monospace;
      font-weight: 600;
      font-size: calc(var(--numSize) * 0.28);
      opacity: 0.85;
    }

    .dash{
      position:absolute;
      left:50%;
      top: 64%;
      transform: translate(-50%,-50%) translateY(var(--dashY));
      width: var(--dashW);
      height: 0;
      border-top: 3px dashed rgba(244,176,0,0.55);
      filter: drop-shadow(0 0 6px rgba(244,176,0,0.10));
    }

    .status{
      position:absolute;
      left:50%;
      top: 76%;
      transform: translate(-50%,-50%) translateY(var(--statusY));
      font-family: "Noto Serif JP","Yu Mincho","Hiragino Mincho ProN",serif;
      font-weight: 700;
      font-size: var(--statusSize);
      letter-spacing: 0.06em;
      color: rgba(244,176,0,0.92);
      white-space: nowrap;
      text-shadow: 0 0 10px rgba(244,176,0,0.10);
    }

    /* ===== コントロール（透ける・固定・スクロール可） ===== */
    .panel{
      position: fixed;
      left: 12px;
      right: 12px;
      bottom: calc(12px + env(safe-area-inset-bottom));
      border-radius: 18px;
      background: rgba(0,0,0,0.28);          /* スケスケ */
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 16px 40px rgba(0,0,0,0.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow: hidden;
      max-width: 760px;
      margin: 0 auto;
    }

    .panelHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 10px 12px;
    }

    .panelTitle{
      font-family: system-ui, -apple-system, "SF Pro Display", sans-serif;
      font-weight: 650;
      font-size: 14px;
      color: rgba(255,255,255,0.92);
      letter-spacing: 0.02em;
    }

    .panelHint{
      font-family: system-ui, -apple-system, "SF Pro Display", sans-serif;
      font-size: 12px;
      color: rgba(255,255,255,0.75);
      margin-top: 2px;
    }

    .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.92);
      padding: 8px 12px;
      border-radius: 14px;
      font-weight: 650;
      font-size: 12px;
      letter-spacing: 0.02em;
    }
    .btn:active{ transform: translateY(1px); }

    .panelBody{
      padding: 10px 12px 12px;
      display: none;
      max-height: 42vh;          /* ここがスクロール領域 */
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;       /* パネル内は縦スクロールOK */
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .row{
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .labelLine{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .label{
      font-family: system-ui, -apple-system, "SF Pro Display", sans-serif;
      font-size: 13px;
      font-weight: 650;
      color: rgba(255,255,255,0.92);
    }

    .val{
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size: 12px;
      color: rgba(255,255,255,0.75);
    }

    input[type="range"]{
      width: 100%;
      accent-color: var(--gold);
      height: 28px;
      background: transparent;

      /* ★iOS/LINEで縦スクロールに吸われない */
      touch-action: pan-x; /* 横ドラッグだけ許可 */
      -webkit-user-select: none;
      user-select: none;
    }

    .actions{
      display:flex;
      gap: 10px;
      margin-top: 10px;
    }
    .actions .btn{
      flex:1;
      padding: 12px 12px;
      border-radius: 16px;
      font-size: 13px;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(90px + env(safe-area-inset-bottom));
      transform: translateX(-50%);
      padding: 10px 14px;
      background: rgba(0,0,0,0.65);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 999px;
      color: rgba(255,255,255,0.92);
      font-family: system-ui, -apple-system, "SF Pro Display", sans-serif;
      font-weight: 650;
      font-size: 13px;
      display:none;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      max-width: 92vw;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" id="card">

      <!-- 四角（外枠+内枠） -->
      <svg class="frame" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
        <!-- 外枠 -->
        <rect
          x="7" y="7" width="86" height="86"
          rx="18" ry="18"
          fill="none"
          stroke="rgba(244,176,0,0.98)"
          stroke-width="5"
        />
        <!-- 内枠 -->
        <rect
          x="14" y="14" width="72" height="72"
          rx="14" ry="14"
          fill="none"
          stroke="rgba(244,176,0,0.48)"
          stroke-width="3"
        />
      </svg>

      <div class="layer">
        <div class="title" id="titleText">メモリ稼働率</div>

        <div class="numRow" id="numRow">
          <div class="num" id="numText">60</div>
          <div class="unit" id="unitText">%</div>
        </div>

        <div class="dash" id="dashLine"></div>

        <div class="status" id="statusText">稼働状態：通常</div>
      </div>
    </div>
  </div>

  <!-- 透けパネル -->
  <div class="panel" id="panel">
    <div class="panelHeader">
      <div>
        <div class="panelTitle">位置調整（縦）＋文字サイズ＋点線長さ</div>
        <div class="panelHint">スライダーで決めたら COPY → そのまま俺に送れ。</div>
      </div>
      <button class="btn" id="toggleBtn">SHOW</button>
    </div>

    <div class="panelBody" id="panelBody">
      <div class="grid">

        <!-- Y調整 -->
        <div class="row">
          <div class="labelLine">
            <div class="label">題目 Y</div>
            <div class="val" id="vTitleY">0px</div>
          </div>
          <input type="range" id="sTitleY" min="-160" max="160" step="1" value="0">
        </div>

        <div class="row">
          <div class="labelLine">
            <div class="label">数字 Y</div>
            <div class="val" id="vNumY">0px</div>
          </div>
          <input type="range" id="sNumY" min="-160" max="160" step="1" value="0">
        </div>

        <div class="row">
          <div class="labelLine">
            <div class="label">点線 Y</div>
            <div class="val" id="vDashY">0px</div>
          </div>
          <input type="range" id="sDashY" min="-160" max="160" step="1" value="0">
        </div>

        <div class="row">
          <div class="labelLine">
            <div class="label">稼働状態 Y</div>
            <div class="val" id="vStatusY">0px</div>
          </div>
          <input type="range" id="sStatusY" min="-160" max="160" step="1" value="0">
        </div>

        <!-- 文字サイズ -->
        <div class="row">
          <div class="labelLine">
            <div class="label">題目 サイズ</div>
            <div class="val" id="vTitleSize">22px</div>
          </div>
          <input type="range" id="sTitleSize" min="12" max="40" step="1" value="22">
        </div>

        <div class="row">
          <div class="labelLine">
            <div class="label">数字 サイズ</div>
            <div class="val" id="vNumSize">92px</div>
          </div>
          <input type="range" id="sNumSize" min="40" max="150" step="1" value="92">
        </div>

        <div class="row">
          <div class="labelLine">
            <div class="label">稼働状態 サイズ</div>
            <div class="val" id="vStatusSize">20px</div>
          </div>
          <input type="range" id="sStatusSize" min="10" max="34" step="1" value="20">
        </div>

        <!-- 点線長さ -->
        <div class="row">
          <div class="labelLine">
            <div class="label">点線 長さ</div>
            <div class="val" id="vDashW">220px</div>
          </div>
          <input type="range" id="sDashW" min="80" max="420" step="1" value="220">
        </div>

        <div class="actions">
          <button class="btn" id="copyBtn">COPY</button>
          <button class="btn" id="resetBtn">RESET</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">コピーした</div>

  <script>
    const root = document.documentElement;

    const el = {
      toggleBtn: document.getElementById("toggleBtn"),
      panelBody: document.getElementById("panelBody"),
      toast: document.getElementById("toast"),
      copyBtn: document.getElementById("copyBtn"),
      resetBtn: document.getElementById("resetBtn"),

      sTitleY: document.getElementById("sTitleY"),
      sNumY: document.getElementById("sNumY"),
      sDashY: document.getElementById("sDashY"),
      sStatusY: document.getElementById("sStatusY"),

      sTitleSize: document.getElementById("sTitleSize"),
      sNumSize: document.getElementById("sNumSize"),
      sStatusSize: document.getElementById("sStatusSize"),

      sDashW: document.getElementById("sDashW"),

      vTitleY: document.getElementById("vTitleY"),
      vNumY: document.getElementById("vNumY"),
      vDashY: document.getElementById("vDashY"),
      vStatusY: document.getElementById("vStatusY"),

      vTitleSize: document.getElementById("vTitleSize"),
      vNumSize: document.getElementById("vNumSize"),
      vStatusSize: document.getElementById("vStatusSize"),

      vDashW: document.getElementById("vDashW"),
    };

    const KEY = "goja_tuner_square_v1";

    function showToast(msg){
      el.toast.textContent = msg;
      el.toast.style.display = "block";
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>{ el.toast.style.display="none"; }, 1200);
    }

    function setVar(name, value){
      root.style.setProperty(name, value);
    }

    function applyFromSliders(){
      const titleY = Number(el.sTitleY.value);
      const numY = Number(el.sNumY.value);
      const dashY = Number(el.sDashY.value);
      const statusY = Number(el.sStatusY.value);

      const titleSize = Number(el.sTitleSize.value);
      const numSize = Number(el.sNumSize.value);
      const statusSize = Number(el.sStatusSize.value);

      const dashW = Number(el.sDashW.value);

      setVar("--titleY", titleY + "px");
      setVar("--numY", numY + "px");
      setVar("--dashY", dashY + "px");
      setVar("--statusY", statusY + "px");

      setVar("--titleSize", titleSize + "px");
      setVar("--numSize", numSize + "px");
      setVar("--statusSize", statusSize + "px");

      setVar("--dashW", dashW + "px");

      el.vTitleY.textContent = titleY + "px";
      el.vNumY.textContent = numY + "px";
      el.vDashY.textContent = dashY + "px";
      el.vStatusY.textContent = statusY + "px";

      el.vTitleSize.textContent = titleSize + "px";
      el.vNumSize.textContent = numSize + "px";
      el.vStatusSize.textContent = statusSize + "px";

      el.vDashW.textContent = dashW + "px";

      save();
    }

    function save(){
      const data = {
        titleY: el.sTitleY.value,
        numY: el.sNumY.value,
        dashY: el.sDashY.value,
        statusY: el.sStatusY.value,
        titleSize: el.sTitleSize.value,
        numSize: el.sNumSize.value,
        statusSize: el.sStatusSize.value,
        dashW: el.sDashW.value
      };
      localStorage.setItem(KEY, JSON.stringify(data));
    }

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return;
        const d = JSON.parse(raw);

        if(d.titleY != null) el.sTitleY.value = d.titleY;
        if(d.numY != null) el.sNumY.value = d.numY;
        if(d.dashY != null) el.sDashY.value = d.dashY;
        if(d.statusY != null) el.sStatusY.value = d.statusY;

        if(d.titleSize != null) el.sTitleSize.value = d.titleSize;
        if(d.numSize != null) el.sNumSize.value = d.numSize;
        if(d.statusSize != null) el.sStatusSize.value = d.statusSize;

        if(d.dashW != null) el.sDashW.value = d.dashW;
      }catch(e){}
    }

    function resetAll(){
      el.sTitleY.value = 0;
      el.sNumY.value = 0;
      el.sDashY.value = 0;
      el.sStatusY.value = 0;

      el.sTitleSize.value = 22;
      el.sNumSize.value = 92;
      el.sStatusSize.value = 20;

      el.sDashW.value = 220;

      applyFromSliders();
      showToast("リセットした");
    }

    async function copyConfig(){
      const cfg = {
        titleY: Number(el.sTitleY.value),
        numY: Number(el.sNumY.value),
        dashY: Number(el.sDashY.value),
        statusY: Number(el.sStatusY.value),
        titleSize: Number(el.sTitleSize.value),
        numSize: Number(el.sNumSize.value),
        statusSize: Number(el.sStatusSize.value),
        dashW: Number(el.sDashW.value),
      };

      const text =
`GOJA TUNER 値（これを俺に送れ）
titleY=${cfg.titleY}
numY=${cfg.numY}
dashY=${cfg.dashY}
statusY=${cfg.statusY}
titleSize=${cfg.titleSize}
numSize=${cfg.numSize}
statusSize=${cfg.statusSize}
dashW=${cfg.dashW}`;

      try{
        await navigator.clipboard.writeText(text);
        showToast("コピーした");
      }catch(e){
        prompt("これをコピーして送れ", text);
      }
    }

    function setPanel(open){
      el.panelBody.style.display = open ? "block" : "none";
      el.toggleBtn.textContent = open ? "HIDE" : "SHOW";
    }

    [
      el.sTitleY, el.sNumY, el.sDashY, el.sStatusY,
      el.sTitleSize, el.sNumSize, el.sStatusSize,
      el.sDashW
    ].forEach(r => {
      r.addEventListener("input", applyFromSliders);
      r.addEventListener("change", applyFromSliders);
    });

    el.toggleBtn.addEventListener("click", ()=>{
      const open = el.panelBody.style.display !== "block";
      setPanel(open);
    });

    el.copyBtn.addEventListener("click", copyConfig);
    el.resetBtn.addEventListener("click", resetAll);

    // ★iOS/LINE: スライダー操作中は縦スクロールに吸われない
    document.querySelectorAll('input[type="range"]').forEach((r) => {
      const stop = (e) => { e.stopPropagation(); };

      r.addEventListener("touchstart", stop, { passive: true });
      r.addEventListener("touchmove", (e) => { e.preventDefault(); }, { passive: false });
      r.addEventListener("touchend", stop, { passive: true });
    });

    load();
    applyFromSliders();
    setPanel(false);
  </script>
</body>
</html>
